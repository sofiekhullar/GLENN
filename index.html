<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/1.1.0/annyang.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>
  <body>
    <h1>Hi, my name is GLENN!</h1>
    <h3 id='glenn-heard'></h3>
    <h2 id='now-playing'></h2>

    <input id="word" value="I like the sound of the piano better, but I love the portability of a guitar">
    <button onClick="getWordClasses()">Get word classes</button>

    <button onClick="textAnalysis()">Test shit!</button>

    <div id="def"></div>
      </body>
   <script>
      const token = 'BQAOpC-T-tJxq7jT72SUMTd_I94vmC9_zd2i410mYTX8N32RtdPrEpjWGGQFQ_ljfZ5PQ7VhpoA8nep-YlVv2hXHG-ZE2oejmNUPdU6f0XNGA7ZOcUlwYy6VHD5x5m6fW5cJZ6_BPV4';

    var searchSong = function(query){
     $.ajax({
      url: 'https://api.spotify.com/v1/search',
      data: {
          q: query,
          type: 'track'
      },
       headers: {
        'Authorization' : 'Bearer ' + token,
    },
      success: function (response) {
          if (response.tracks.items.length) {
              console.log(response.tracks.items[0].name);
              $('#glenn-heard').html("GLENN heard " + query);
              $('#now-playing').html("Playing " + response.tracks.items[0].name);
              var track = response.tracks.items[0];
              var preview_song = new Audio(track.preview_url);
              preview_song.play();
          }
       },
      error: function(){
          $('#glenn-heard').html("Sorry I don't understand");
      }
    })
   };

      var searchSongWithArtist = function(songName, artistName) {
        var query = songName;
        if (artistName) {
            query += ' artist:' + artistName;
            console.log(query);
        }
        searchSong(query);
      }

        if (annyang) {
          console.log("annyang ok");

          var commands = {
            'play': function() {
              console.log('play');
            },
            'yes': function() {
              console.log('yes');
            },
            
            'hello *test': function(test) {
              console.log("input " + test);
              if(test == 'test'){
                console.log('hello test');
              }else{ 
                console.log('hello no test');
              } 
              
            },
            'play *song': function (song) {
              console.log(song);
              searchSong(song);
            },
            'play *song by *artist': function (song, artist) {
                console.log('Play song ' + song + ' by ' + artist);
                searchSongWithArtist(song, artist);
            },
          };

          // Add our commands to annyang
          annyang.addCommands(commands);
          // Start listening. You can call this here, or attach this call to an event, button, etc.
          annyang.start();
      }

    function getWordClasses() {

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {

            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("def").innerHTML = this.responseText;
            }
        };
        xmlhttp.open("GET", "dictionary.php?q=" + document.getElementById("word").value, true);
        xmlhttp.send();
    }

    function textAnalysis(){
      var APIKey = 'b64036dc989b2b7ce6ef2dfbdd258442';
      var APPId = 'cfc263b9';

      var xmlhttp = new XMLHttpRequest();
      
      xmlhttp.onreadystatechange = function() {

            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("def").innerHTML = this.responseText;
            }
        };
        xmlhttp.open("GET", "Labeling.php?q=" + document.getElementById("word").value, true);
        xmlhttp.send();

       // document.location.href = 'Labeling.php';
    }
    
    function textToSpeech(text, language) {
      var voicelist = responsiveVoice.getVoices();
      var responseLanguage = 'US English Male';
      Object.keys(voicelist).forEach(function(key) {
        if(voicelist[key].name == (language + " Female")){
          responseLanguage = language + ' Female';
        } 
        if(voicelist[key].name == (language + " Male")){
          responseLanguage = language + ' Male';
        }
        });
      responsiveVoice.speak(text, responseLanguage);

    }


</script>

</html>


